FROM python:3.12-slim

RUN pip install --no-cache-dir \
    dagster==1.12.14 \
    dagster-webserver==1.12.14 \
    dagster-postgres==0.28.14 \
    dagster-docker==0.28.14 \
    docker>=7.0.0

# Install the multihost launcher package
COPY dagster_multihost_launcher/ /opt/dagster/src/dagster_multihost_launcher/
COPY pyproject.toml /opt/dagster/src/pyproject.toml
RUN pip install --no-cache-dir /opt/dagster/src

ENV DAGSTER_HOME=/opt/dagster/dagster_home
RUN mkdir -p $DAGSTER_HOME

WORKDIR /opt/dagster/dagster_home
